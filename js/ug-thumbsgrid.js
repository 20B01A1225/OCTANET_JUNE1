function UGThumbsGrid(){var e,t,n,r,s,a,o=this,u=jQuery(this),d=new UniteGalleryMain,h=new UGFunctions,g=new UGThumbsGeneral,c=new UGTileDesign,l={grid_panes_direction:"left",grid_num_cols:2,grid_min_cols:2,grid_num_rows:2,grid_space_between_cols:13,grid_space_between_rows:10,grid_space_between_mobile:10,grid_transition_duration:300,grid_transition_easing:"easeInOutQuad",grid_carousel:!1,grid_padding:0,grid_vertical_scroll_ondrag:!1};this.events={PANE_CHANGE:"pane_change"};var _={eventSizeChange:"thumb_size_change",isHorizontal:!1,isMaxHeight:!1,isMaxWidth:!1,gridHeight:0,gridWidth:0,innerWidth:0,innerHeight:0,numPanes:0,arrPanes:0,numThumbs:0,currentPane:0,numThumbsInPane:0,isNavigationVertical:!1,touchActive:!1,startScrollPos:0,isFirstTimeRun:!0,isTilesMode:!1,storedEventID:"thumbsgrid",tileMaxWidth:null,tileMaxHeight:null,spaceBetweenCols:null,spaceBetweenRows:null};function m(i,s,a){var u;if(t=i.getObjects(),(d=i).attachThumbsPanel("grid",o),e=jQuery(i),n=t.g_objWrapper,r=t.g_arrItems,!0===a&&(_.isTilesMode=!0),_.numThumbs=r.length,u=s,l=jQuery.extend(l,u),g.setOptions(u),_.isNavigationVertical="top"==l.grid_panes_direction||"bottom"==l.grid_panes_direction,_.spaceBetweenCols=l.grid_space_between_cols,_.spaceBetweenRows=l.grid_space_between_rows,1==_.isTilesMode){c.setFixedMode(),c.setApproveClickFunction(N),c.init(i,l);var h=c.getOptions();_.tileMaxHeight=h.tile_height,_.tileMaxWidth=h.tile_width,g=c.getObjThumbs()}else s.thumb_fixed_size=!0,g.init(i,s)}function f(){var t=d.getSelectedItem();(function(){if(0==_.isHorizontal){if(0==_.gridHeight)throw new Error("You must set height before run.")}else if(0==_.gridWidth)throw new Error("You must set width before run.")}(),1==_.isFirstTimeRun)?(!function(){if(0==_.isTilesMode){g.initEvents(),s.find(".ug-thumb-wrapper").on("click touchend",C),e.on(d.events.ITEM_CHANGE,A)}else c.initEvents();s.bind("mousedown touchstart",B),jQuery("body").bind("mousemove touchmove",x),jQuery(window).add("body").bind("mouseup touchend",y)}(),1==_.isTilesMode?(p(),P(),c.run()):(g.setHtmlProperties(),P(),g.loadThumbsImages())):1==_.isTilesMode&&1==p()&&(P(),c.run());if(0==_.isHorizontal?_.isNavigationVertical?function(){var e=a.children(".ug-thumb-wrapper"),t=0,n=0,r=0,o=0,u=0,d=0;_.innerWidth=0,_.numPanes=1,_.arrPanes=[],_.numThumbsInPane=0,_.arrPanes.push(u);var g=e.length;for(i=0;i<g;i++){var c=jQuery(e[i]);h.placeElement(c,t,n);var m=c.outerWidth(),f=c.outerHeight();t+=m+_.spaceBetweenCols;var v=n+f;v>r&&(r=v),++o>=l.grid_num_cols&&(n+=f+_.spaceBetweenRows,t=u,o=0),1==_.numPanes&&_.numThumbsInPane++,v=n+f;var p=d+_.gridHeight;v>p&&(1==_.isMaxHeight&&1==_.numPanes&&(_.gridHeight=r,s.height(_.gridHeight),p=_.gridHeight),d=n=p+_.spaceBetweenRows,t=u=0,o=0,i<g-1&&(_.numPanes++,_.arrPanes.push(n)))}a.height(r),_.innerHeight=r,1==_.isMaxHeight&&1==_.numPanes&&(_.gridHeight=r,s.height(r))}():function(){var e=a.children(".ug-thumb-wrapper"),t=0,n=0,r=0,o=0,u=0,d=0;_.innerWidth=0,_.numPanes=1,_.arrPanes=[],_.numThumbsInPane=0,_.arrPanes.push(o);var g=e.length;for(i=0;i<g;i++){var c=jQuery(e[i]);h.placeElement(c,t,n);var m=c.outerWidth(),f=c.outerHeight();t>u&&(u=t);var v=n+f;v>d&&(d=v);var p=u+m;p>_.innerWidth&&(_.innerWidth=p),t+=m+_.spaceBetweenCols,++r>=l.grid_num_cols&&(n+=f+_.spaceBetweenRows,t=o,r=0),1==_.numPanes&&_.numThumbsInPane++,n+f>_.gridHeight&&(n=0,t=o=_.innerWidth+_.spaceBetweenCols,r=0,1==_.isMaxHeight&&1==_.numPanes&&(_.gridHeight=d,s.height(_.gridHeight)),i<g-1&&(_.numPanes++,_.arrPanes.push(o)))}a.width(_.innerWidth),1==_.isMaxHeight&&1==_.numPanes&&(_.gridHeight=d,s.height(d))}():function(){var e=a.children(".ug-thumb-wrapper"),t=l.grid_padding,n=l.grid_padding,r=n,o=t,u=0,d=0,g=0,c=0,m=0;_.innerWidth=0,_.numPanes=1,_.arrPanes=[],_.numThumbsInPane=0,_.arrPanes.push(t-l.grid_padding);var f=e.length;for(i=0;i<f;i++){var v=jQuery(e[i]),p=v.outerWidth(),P=v.outerHeight();o-t+p>_.gridWidth&&(r=0,++m>=l.grid_num_rows?(m=0,t=o,r=n,g=0,1==_.numPanes&&(_.gridWidth=u+l.grid_padding,s.width(_.gridWidth),_.gridHeight=c+l.grid_padding,s.height(_.gridHeight)),_.numPanes++,_.arrPanes.push(t-l.grid_padding)):(o=t,r=g+_.spaceBetweenRows)),h.placeElement(v,o,r),(w=o+p)>u&&(u=w);var w,b=r+P;b>g&&(g=b),b>c&&(c=b),b>d&&(d=b),(w=u+p)>_.innerWidth&&(_.innerWidth=w),o+=p+_.spaceBetweenCols,1==_.numPanes&&_.numThumbsInPane++}_.innerWidth=u+l.grid_padding,_.innerHeight=c+l.grid_padding,a.width(_.innerWidth),a.height(_.innerHeight),1==_.numPanes&&(_.gridWidth=u+l.grid_padding,_.gridHeight=c+l.grid_padding,s.width(_.gridWidth),s.height(_.gridHeight))}(),1==_.isFirstTimeRun&&_.isTilesMode){var r=g.getThumbs();r.each((function(e,t){n.trigger(_.eventSizeChange,jQuery(t))})),r.fadeTo(0,1)}null!=t&&w(t.index),u.trigger(o.events.PANE_CHANGE,_.currentPane),_.isFirstTimeRun=!1}function v(){if(1==_.isTilesMode)var e=c.getGlobalTileSize();else e=g.getGlobalThumbSize();return e}function p(){if(0==_.isTilesMode)throw new Error("Dynamic size can be set only in tiles mode");var e=!1,t=d.isMobileMode(),i=_.spaceBetweenCols;1==t?(_.spaceBetweenCols=l.grid_space_between_mobile,_.spaceBetweenRows=l.grid_space_between_mobile):(_.spaceBetweenCols=l.grid_space_between_cols,_.spaceBetweenRows=l.grid_space_between_rows),_.spaceBetweenCols!=i&&(e=!0);var n=v().width,r=_.tileMaxWidth;return h.getNumItemsInSpace(_.gridWidth,_.tileMaxWidth,_.spaceBetweenCols)<l.grid_min_cols&&(r=h.getItemSizeInSpace(_.gridWidth,l.grid_min_cols,_.spaceBetweenCols)),c.setTileSizeOptions(r),r!=n&&(e=!0),e}function P(){var e,t,i;0==_.isHorizontal?(e=v().width,t=l.grid_num_cols*e+(l.grid_num_cols-1)*_.spaceBetweenCols+2*l.grid_padding,i=_.gridHeight,_.gridWidth=t,h.setElementSize(s,t,i),h.setElementSize(a,t,i),_.innerWidth=t,_.innerHeight=i):function(){var e=v().height,t=_.gridWidth,i=l.grid_num_rows*e+(l.grid_num_rows-1)*_.spaceBetweenRows+2*l.grid_padding;_.gridHeight=i,h.setElementSize(s,t,i),h.setElementSize(a,t,i),_.innerWidth=t,_.innerHeight=i}()}function w(e){var t=I(e);if(-1==t)return!1;o.gotoPane(t,"scroll")}function b(e){if(e>=_.numPanes||e<0)throw new Error("Pane "+index+" doesn't exists.");return!0}function E(e){var t=T(e);if(0==t)return!1;a.stop(!0).animate(t,{duration:l.grid_transition_duration,easing:l.grid_transition_easing,queue:!1})}function H(){E(-_.arrPanes[_.currentPane])}function T(e){var t={};return 1==_.isNavigationVertical?t.top=e+"px":t.left=e+"px",t}function M(){var e=h.getElementSize(a);return 1==_.isNavigationVertical?e.top:e.left}function I(e){return 0==function(e){if(e<0||e>=_.numThumbs)throw new Error("Thumb not exists: "+e);return!0}(e)?-1:Math.floor(e/_.numThumbsInPane)}function W(){var e=h.getStoredEventData(_.storedEventID),t=M();diffPos=Math.abs(e.startInnerPos-t);var i=1==_.isNavigationVertical?_.gridHeight:_.gridWidth,n=Math.round(3*i/8);return diffPos>=n||e.diffTime<300&&diffPos>25}function N(){return 1==_.numPanes||h.isApproveStoredEventClick(_.storedEventID,_.isNavigationVertical)}function C(e){if(1==function(){if(1==_.numPanes)return!1;var e=h.getStoredEventData(_.storedEventID),t=e.diffTime,i=M(),n=Math.abs(i-e.startInnerPos);return n>30||n>5&&t>300}())return!0;var t=jQuery(this),i=g.getItemByThumb(t);d.selectItem(i)}function B(e){if(1==_.numPanes)return!0;if(1==_.touchActive)return!0;0==_.isTilesMode&&e.preventDefault(),_.touchActive=!0;var t={startInnerPos:M()};h.storeEventData(e,_.storedEventID,t)}function x(e){if(0==_.touchActive)return!0;e.preventDefault(),h.updateStoredEventData(e,_.storedEventID);var t=h.getStoredEventData(_.storedEventID,_.isNavigationVertical);if(0!=l.grid_vertical_scroll_ondrag&&1!=_.isNavigationVertical&&"vert"===h.handleScrollTop(_.storedEventID))return!0;var i=t.diffMousePos,n=t.startInnerPos+i,r=i>0?"prev":"next",s=_.arrPanes[_.numPanes-1];0==l.grid_carousel&&n>0&&"prev"==r&&(n/=3),0==l.grid_carousel&&n<-s&&"next"==r&&(n=t.startInnerPos+i/3),function(e){var t=T(e);if(0==t)return!1;a.css(t)}(n)}function y(e){if(0==_.touchActive)return!0;h.updateStoredEventData(e,_.storedEventID);var t=h.getStoredEventData(_.storedEventID,_.isNavigationVertical);if(_.touchActive=!1,0==W())return H(),!0;"next"==(M()-t.startInnerPos>0?"prev":"next")?0==l.grid_carousel&&o.isLastPane()?H():o.nextPane():0==l.grid_carousel&&o.isFirstPane()?H():o.prevPane()}function A(){var e=d.getSelectedItem();g.setThumbSelected(e.objThumbWrapper),w(e.index)}this.destroy=function(){if(0==_.isTilesMode){var t=s.find(".ug-thumb-wrapper");t.off("click"),t.off("touchend"),e.on(d.events.ITEM_CHANGE),g.destroy()}else c.destroy();s.unbind("mousedown"),s.unbind("touchstart"),jQuery("body").unbind("mousemove"),jQuery("body").unbind("touchmove"),jQuery(window).add("body").unbind("touchend"),jQuery(window).add("body").unbind("mouseup"),u.off(o.events.PANE_CHANGE)},this.__________EXTERNAL_GENERAL_________=function(){},this.setThumbUnselected=function(e){g.setThumbUnselected(e)},this.isItemThumbVisible=function(e){return I(e.index)==_.currentPane},this.__________EXTERNAL_API_________=function(){},this.getNumPanesEstimationByHeight=function(e){if(1==_.isTilesMode)var t=l.tile_height;else t=g.getOptions().thumb_height;var i=g.getNumThumbs(),n=Math.ceil(i/l.grid_num_cols),r=n*t+(n-1)*_.spaceBetweenRows;return Math.ceil(r/e)},this.getNumPanesEstimationByWidth=function(e){if(_.isTilesMode)var t=l.tile_width;else t=g.getOptions().thumb_width;var i=g.getNumThumbs(),n=Math.ceil(i/l.grid_num_rows),r=n*t+(n-1)*_.spaceBetweenCols;return Math.ceil(r/e)},this.getHeightEstimationByWidth=function(e){if(0==_.isTilesMode)throw new Error("This function works only with tiles mode");var t=g.getNumThumbs(),i=h.getNumItemsInSpace(e,l.tile_width,_.spaceBetweenCols),n=Math.ceil(t/i);n>l.grid_num_rows&&(n=l.grid_num_rows);var r=h.getSpaceByNumItems(n,l.tile_height,_.spaceBetweenRows);return r+=2*l.grid_padding},this.getElement=function(){return s},this.getSize=function(){return h.getElementSize(s)},this.getNumPanes=function(){return _.numPanes},this.isFirstPane=function(){return 0==_.currentPane},this.isLastPane=function(){return _.currentPane==_.numPanes-1},this.getPaneInfo=function(){return{pane:_.currentPane,total:_.numPanes}},this.getPane=function(){return _.currentPane},this.setWidth=function(e){_.gridWidth=e,_.isHorizontal=!0},this.setMaxWidth=function(e){_.gridWidth=e,_.isMaxWidth=!0,_.isHorizontal=!0},this.setHeight=function(e){_.gridHeight=e,_.isHorizontal=!1},this.setMaxHeight=function(e){_.gridHeight=e,_.isMaxHeight=!0,_.isHorizontal=!1},this.gotoPane=function(e,t){if(0==b(e))return!1;if(e==_.currentPane)return!1;var i=-_.arrPanes[e];_.currentPane=e,E(i),u.trigger(o.events.PANE_CHANGE,e)},this.nextPane=function(){var e=_.currentPane+1;if(e>=_.numPanes){if(0==l.grid_carousel)return!0;e=0}o.gotoPane(e,"next")},this.prevPane=function(){var e=_.currentPane-1;if(e<0&&(e=_.numPanes-1,0==l.grid_carousel))return!1;o.gotoPane(e,"prev")},this.attachNextPaneButton=function(e){if(h.setButtonOnClick(e,o.nextPane),1==l.grid_carousel)return!0;o.isLastPane()&&e.addClass("ug-button-disabled"),u.on(o.events.PANE_CHANGE,(function(){o.isLastPane()?e.addClass("ug-button-disabled"):e.removeClass("ug-button-disabled")}))},this.attachPrevPaneButton=function(e){if(h.setButtonOnClick(e,o.prevPane),1==l.grid_carousel)return!0;o.isFirstPane()&&e.addClass("ug-button-disabled"),u.on(o.events.PANE_CHANGE,(function(){o.isFirstPane()?e.addClass("ug-button-disabled"):e.removeClass("ug-button-disabled")}))},this.attachBullets=function(e){e.setActive(_.currentPane),jQuery(e).on(e.events.BULLET_CLICK,(function(t,i){o.gotoPane(i,"theme"),e.setActive(i)})),jQuery(o).on(o.events.PANE_CHANGE,(function(t,i){e.setActive(i)}))},this.getObjTileDesign=function(){return c},this.init=function(e,t,i){m(e,t,i)},this.run=function(){f()},this.setHtml=function(e){!function(e){var t=n;e&&(t=e),t.append("<div class='ug-thumbs-grid'><div class='ug-thumbs-grid-inner'></div></div>"),s=t.children(".ug-thumbs-grid"),a=s.children(".ug-thumbs-grid-inner"),1==_.isTilesMode?c.setHtml(a):g.setHtmlThumbs(a)}(e)}}