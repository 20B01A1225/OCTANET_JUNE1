function UGTileDesign(){var e,t,i=this,n=jQuery(this),l=new UniteGalleryMain,a=new UGFunctions,o=new UGThumbsGeneral;this.resizemode={FULL:"full",WRAPPER_ONLY:"wrapper_only",VISIBLE_ELEMENTS:"visible_elements"},this.sizeby={GLOBAL_RATIO:"global_ratio",TILE_RATIO:"tile_ratio",IMAGE_RATIO:"image_ratio",CUSTOM:"custom"},this.events={TILE_CLICK:"tile_click"};var r={tile_width:250,tile_height:200,tile_size_by:i.sizeby.IMAGE_RATIO,tile_visible_before_image:!1,tile_enable_background:!0,tile_background_color:"#F0F0F0",tile_enable_border:!1,tile_border_width:3,tile_border_color:"#F0F0F0",tile_border_radius:0,tile_enable_outline:!1,tile_outline_color:"#8B8B8B",tile_enable_shadow:!1,tile_shadow_h:1,tile_shadow_v:1,tile_shadow_blur:3,tile_shadow_spread:2,tile_shadow_color:"#8B8B8B",tile_enable_action:!0,tile_as_link:!1,tile_link_newpage:!0,tile_enable_overlay:!0,tile_overlay_opacity:.4,tile_overlay_color:"#000000",tile_enable_icons:!1,tile_show_link_icon:!1,tile_videoplay_icon_always_on:"never",tile_space_between_icons:26,tile_enable_image_effect:!1,tile_image_effect_type:"bw",tile_image_effect_reverse:!1,tile_enable_textpanel:!1,tile_textpanel_source:"title",tile_textpanel_always_on:!1,tile_textpanel_appear_type:"slide",tile_textpanel_position:"inside_bottom",tile_textpanel_offset:0},_={thumb_color_overlay_effect:!0,thumb_overlay_reverse:!0,thumb_image_overlay_effect:!1,tile_textpanel_enable_description:!1,tile_textpanel_bg_opacity:.6,tile_textpanel_padding_top:8,tile_textpanel_padding_bottom:8},s={ratioByHeight:0,ratioByWidth:0,eventSizeChange:"thumb_size_change",funcCustomTileHtml:null,funcCustomPositionElements:null,funcParentApproveClick:null,isSaparateIcons:!1,tileInnerReduce:0,isTextpanelOutside:!1,hasImageContainer:!1,isVideoplayIconAlwaysOn:!1,isTextPanelHidden:!1};function u(e,n){l=e,jQuery(e);var u=l.getObjects();t=u.g_objWrapper,l.getArrItems(),r=jQuery.extend(r,_),r=jQuery.extend(r,n),function(){1==r.tile_enable_overlay?(r.thumb_overlay_opacity=r.tile_overlay_opacity,r.thumb_overlay_color=r.tile_overlay_color):0==r.tile_enable_icons?r.thumb_color_overlay_effect=!1:r.thumb_overlay_opacity=0;r.tile_as_link&&(r.thumb_wrapper_as_link=!0,r.thumb_link_newpage=r.tile_link_newpage);1==r.tile_enable_outline&&0==r.tile_enable_border&&(r.tile_enable_outline=!1);s.tileInnerReduce=0,r.tile_enable_border&&(s.tileInnerReduce=2*r.tile_border_width,o.setThumbInnerReduce(s.tileInnerReduce));if(s.isSaparateIcons=!a.isRgbaSupported(),1==r.tile_enable_textpanel){switch(r.tile_textpanel_position){case"top":r.tile_textpanel_align="top";case"bottom":s.isTextpanelOutside=!0,r.tile_textpanel_always_on=!0,r.tile_textpanel_offset=0;break;case"inside_top":r.tile_textpanel_align="top";break;case"middle":r.tile_textpanel_align="middle",r.tile_textpanel_appear_type="fade"}0==r.tile_textpanel_always_on&&(s.isSaparateIcons=!0)}0!=r.tile_textpanel_offset&&(r.tile_textpanel_appear_type="fade",r.tile_textpanel_margin=r.tile_textpanel_offset);"title_and_desc"==r.tile_textpanel_source&&(r.tile_textpanel_enable_description=!0,r.tile_textpanel_desc_style_as_title=!0)}(),o.init(e,r);var c=["overlay"];s.funcCustomTileHtml&&(c=[]),o.setCustomThumbs(d,c,{allow_onresize:!1});var h=o.getOptions();r=jQuery.extend(r,h),s.ratioByWidth=r.tile_width/r.tile_height,s.ratioByHeight=r.tile_height/r.tile_width,r.tile_size_by==i.sizeby.GLOBAL_RATIO&&s.isTextpanelOutside&&(s.hasImageContainer=!0)}function c(){var e=l.isMobileMode();switch(s.isTextPanelHidden=!1,1==e&&0==r.tile_textpanel_always_on&&(s.isTextPanelHidden=!0),s.isVideoplayIconAlwaysOn=r.tile_videoplay_icon_always_on,r.tile_videoplay_icon_always_on){case"always":s.isVideoplayIconAlwaysOn=!0;break;case"never":s.isVideoplayIconAlwaysOn=!1;break;case"mobile_only":s.isVideoplayIconAlwaysOn=1==e;break;case"desktop_only":s.isVideoplayIconAlwaysOn=0==e}}function d(e,t){if(e.addClass("ug-tile"),s.funcCustomTileHtml)return s.funcCustomTileHtml(e,t),!1;var n="";1==s.hasImageContainer&&(n+="<div class='ug-image-container ug-trans-enabled'>");var o="ug-thumb-image";0!=r.tile_enable_image_effect&&1!=r.tile_image_effect_reverse||(o+=" ug-trans-enabled");var _=a.stripTags(t.title);_=a.htmlentitles(_),n+='<img src="'+a.escapeDoubleSlash(t.urlThumb)+"\" alt='"+_+"' class='"+o+"'>",1==s.hasImageContainer&&(n+="</div>"),e.append(n),r.tile_size_by==i.sizeby.GLOBAL_RATIO&&e.fadeTo(0,0);var u={};if(1==r.tile_enable_background&&(u["background-color"]=r.tile_background_color),1==r.tile_enable_border&&(u["border-width"]=r.tile_border_width+"px",u["border-style"]="solid",u["border-color"]=r.tile_border_color,r.tile_border_radius&&(u["border-radius"]=r.tile_border_radius+"px")),1==r.tile_enable_outline&&(u.outline="1px solid "+r.tile_outline_color),1==r.tile_enable_shadow){var c=r.tile_shadow_h+"px ";c+=r.tile_shadow_v+"px ",c+=r.tile_shadow_blur+"px ",c+=r.tile_shadow_spread+"px ",c+=r.tile_shadow_color,u["box-shadow"]=c}e.css(u);var d="";if(r.tile_enable_icons){if(0==r.tile_as_link&&1==r.tile_enable_action){var h="ug-button-play ug-icon-zoom";"image"!=t.type&&(h="ug-button-play ug-icon-play"),d+="<div class='ug-tile-icon "+h+"' style='display:none'></div>"}if(t.link&&1==r.tile_show_link_icon||1==r.tile_as_link)if(0==r.tile_as_link){var p="";1==r.tile_link_newpage&&(p=" target='_blank'"),d+="<a href='"+t.link+"'"+p+" class='ug-tile-icon ug-icon-link'></a>"}else d+="<div class='ug-tile-icon ug-icon-link' style='display:none'></div>";var f=s.isSaparateIcons;if(0==f&&"image"!=t.type&&1==s.isVideoplayIconAlwaysOn&&(f=!0),f)var b=e;else b=e.children(".ug-thumb-overlay");b.append(d);var m=b.children("."+h);0==m.length?m=null:m.hide();var v=b.children(".ug-icon-link");0==v.length?v=null:v.hide(),v||1!=r.tile_enable_action||e.addClass("ug-tile-clickable")}else 1==r.tile_enable_action&&e.addClass("ug-tile-clickable");if(1==r.tile_enable_image_effect){var y="";0==r.tile_image_effect_reverse&&(y=" ug-trans-enabled");var T="<div class='ug-tile-image-overlay"+y+"' >",w=" ug-"+r.tile_image_effect_type+"-effect";T+='<img src="'+a.escapeDoubleSlash(t.urlThumb)+"\" alt='"+t.title+"' class='"+w+y+"'>",T+="</div>",e.append(T),1==r.tile_image_effect_reverse&&e.children(".ug-tile-image-overlay").fadeTo(0,0)}if(1==r.tile_enable_textpanel){var x=new UGTextPanel;x.init(l,r,"tile");var I="";1!=r.tile_textpanel_always_on&&1!=s.isTextpanelOutside||(I="ug-trans-enabled"),x.appendHTML(e,I);var E=t.title,C="";switch(r.tile_textpanel_source){case"desc":case"description":E=t.description;break;case"desc_title":""!=t.description&&(E=t.description);break;case"title_and_desc":E=t.title,C=t.description}if(x.setTextPlain(E,C),0==r.tile_textpanel_always_on&&x.getElement().fadeTo(0,0),e.data("objTextPanel",x),1==r.tile_textpanel_always_on)g(e).css("z-index",2);if(1==s.isTextpanelOutside){e.append("<div class='ug-tile-cloneswrapper'></div>");var z=e.children(".ug-tile-cloneswrapper"),O=new UGTextPanel;O.init(l,r,"tile"),O.appendHTML(z),O.setTextPlain(E,C),e.data("objTextPanelClone",O)}}null!==t.addHtml&&e.append(t.addHtml)}function h(e){return e.children(".ug-tile-image-overlay")}function p(e){return e.data("objTextPanel")}function g(e){return e.children(".ug-textpanel")}function f(e){if(1==s.isTextpanelOutside)var t=function(e){var t=e.find(".ug-tile-cloneswrapper .ug-textpanel");if(0==t.length)throw new Error("text panel cloned element not found");return t}(e);else t=g(e);return t?a.getElementSize(t).height:0}function b(e){var t=e.find(".ug-icon-link");return 0==t.length?null:t}function m(e){var t=e.find(".ug-button-play");return 0==t.length?null:t}function v(e){return!!e.hasClass("ug-thumb-over")}function y(e){return e.hasClass("ug-tile-clickable")}function T(e){return 1==r.tile_enable_icons&&1==s.isVideoplayIconAlwaysOn&&"image"!=e.type}function w(e,t,n,l){var o=h(e),_=i.getTileImage(e),u=function(e){return e.find(".ug-tile-image-overlay img")}(e);t-=s.tileInnerReduce,n-=s.tileInnerReduce;var c=null;if(1==s.isTextpanelOutside){var d=f(e);if(n-=d,"top"==r.tile_textpanel_position&&(c=d),1==s.hasImageContainer){var p=function(e){return 0==s.hasImageContainer?null:e.children(".ug-image-container")}(e);a.setElementSize(p,t,n),null!==c&&a.placeElement(p,0,c)}}if(0==r.tile_enable_image_effect)a.scaleImageCoverParent(_,t,n),0==s.hasImageContainer&&null!==c&&a.placeElement(_,0,c);else{var g="nothing";!0===l&&0==s.isTextpanelOutside&&(g=1==r.tile_image_effect_reverse?"effect":"image"),"effect"!=g&&(a.setElementSize(o,t,n),null!==c&&a.placeElement(o,0,c),a.scaleImageCoverParent(u,t,n)),"image"!=g&&(1==s.hasImageContainer?a.scaleImageCoverParent(_,t,n):"effect"==g?(a.scaleImageCoverParent(_,t,n),null!==c&&a.placeElement(_,0,c)):a.cloneElementSizeAndPos(u,_,!1,null,c))}}function x(e,t,n,l){var a=null;if(n&&(a=n-s.tileInnerReduce),l&&(l-=s.tileInnerReduce),"clone"==t)return function(e){return e.data("objTextPanelClone")}(e).refresh(!0,!0,a),i.getItemByTile(e).textPanelCloneSizeSet=!0,!1;var o=p(e);if(!o)return!1;var _=null;if(1==s.isTextpanelOutside&&(_=f(e)),o.refresh(!1,!0,a,_),1==r.tile_textpanel_always_on||"fade"==r.tile_textpanel_appear_type)if(1==s.isTextpanelOutside&&l&&"bottom"==r.tile_textpanel_position){var u=l-_;o.positionPanel(u)}else o.positionPanel()}function I(e){i.getItemByTile(e);var t=m(e),n=b(e),l=a.getElementSize(e);w(e,l.width,l.height),1==r.tile_enable_textpanel&&x(e,"regular",l.width,l.height);var o=l.width-s.tileInnerReduce,_=l.height-s.tileInnerReduce,u=0;if(1==s.isTextpanelOutside){var c=f(e);_-=c,"top"==r.tile_textpanel_position&&(u=c)}var d=function(e){return e.children(".ug-thumb-overlay")}(e);if(a.setElementSizeAndPosition(d,0,u,o,_),t||n){var h=0;if(1==r.tile_enable_textpanel&&0==s.isTextPanelHidden&&0==s.isTextpanelOutside){var p=g(e),v=a.getElementSize(p);v.height>0&&(h=Math.floor(v.height/2*-1))}}if(t&&n){var y=a.getElementSize(t),T=a.getElementSize(n),I=r.tile_space_between_icons,E=y.width+I+T.width,C=Math.floor((l.width-E)/2);C<I&&(I=Math.floor((l.width-y.width-T.width)/3),E=y.width+I+T.width,C=Math.floor((l.width-E)/2)),a.placeElement(t,C,"middle",0,h),a.placeElement(n,C+y.width+I,"middle",0,h)}else t&&a.placeElement(t,"center","middle",0,h),n&&a.placeElement(n,"center","middle",0,h);t&&t.show(),n&&n.show()}function E(e,t){i.getItemByTile(e);var n=h(e),l=r.thumb_transition_duration;if(0==r.tile_image_effect_reverse){var a=i.getTileImage(e);t?(a.fadeTo(0,1),n.stop(!0).fadeTo(l,0)):n.stop(!0).fadeTo(l,1)}else t?n.stop(!0).fadeTo(l,1):n.stop(!0).fadeTo(l,0)}function C(e,t){var i=r.thumb_transition_duration,n=g(e);if(!n)return!0;if("slide"==r.tile_textpanel_appear_type){var l=a.getElementSize(n);if(0==l.width)return!1;var o=-l.height,_={},s={},u="bottom";"inside_top"==r.tile_textpanel_position&&(u="top"),_[u]=o+"px",s[u]="0px",1==t?(n.fadeTo(0,1),0==n.is(":animated")&&n.css(_),s.opacity=1,n.stop(!0).animate(s,i)):n.stop(!0).animate(_,i)}else 1==t?n.stop(!0).fadeTo(i,1):n.stop(!0).fadeTo(i,0)}function z(e,t,i){var n=r.thumb_transition_duration;i&&!0===i&&(n=0);var l=m(e),a=b(e),o=t?1:0;l&&l.stop(!0).fadeTo(n,o),a&&a.stop(!0).fadeTo(n,o)}function O(e,t){if(t=jQuery(t),r.tile_enable_image_effect&&E(t,!0),1==r.tile_enable_textpanel&&0==r.tile_textpanel_always_on&&0==s.isTextPanelHidden&&C(t,!0),s.isSaparateIcons&&1==r.tile_enable_icons){var n=1==r.thumb_overlay_reverse;0==T(i.getItemByTile(t))&&z(t,n,!1)}}function k(e,t){if(t=jQuery(t),r.tile_enable_image_effect&&E(t,!1),1==r.tile_enable_textpanel&&0==r.tile_textpanel_always_on&&C(t,!1),1==s.isSaparateIcons&&1==r.tile_enable_icons){var n=1!=r.thumb_overlay_reverse;0==T(i.getItemByTile(t))?z(t,n,!1):z(t,!0,!0)}}function A(e,t,i){if(t=jQuery(t),1==r.tile_visible_before_image&&!0!==t.data("image_placed")&&!0!==i)return!0;I(t),o.setThumbNormalStyle(t)}function S(e,t,i){I(t),i.fadeTo(0,1),t.data("image_placed",!0)}function L(e){if(1==y(e))return n.trigger(i.events.TILE_CLICK,e),!0;var t;0==v(e)&&(t=e,o.getThumbs().not(t).each((function(e,t){o.setThumbNormalStyle(jQuery(t))})),o.setThumbOverStyle(e))}function P(e){var t=jQuery(this),l=t.prop("tagName").toLowerCase(),a=!0;if(s.funcParentApproveClick&&0==s.funcParentApproveClick()&&(a=!1),"a"==l)0==a&&e.preventDefault();else if(0==v(t))1==a&&L(t);else{if(0==y(t))return!0;1==a&&n.trigger(i.events.TILE_CLICK,t)}}function R(e){e.stopPropagation();var t=jQuery(this).parents(".ug-tile"),l=!0;return s.funcParentApproveClick&&0==s.funcParentApproveClick()&&(l=!1),0==v(t)?(L(t),!0):1==l?(n.trigger(i.events.TILE_CLICK,t),!1):void 0}function B(e){var t=jQuery(this).parents(".ug-tile");s.funcParentApproveClick&&0==s.funcParentApproveClick()&&e.preventDefault(),0==v(t)&&0==r.tile_as_link&&(e.preventDefault(),L(t))}this.loadTileImage=function(e){var t=i.getTileImage(e);a.checkImagesLoaded(t,null,(function(t,i){S(null,e,jQuery(t))}))},this.setHtml=function(t,i){e=t,!0!==i&&c(),o.setHtmlThumbs(t,i)},this.initEvents=function(){o.initEvents(),jQuery(o).on(o.events.SETOVERSTYLE,O),jQuery(o).on(o.events.SETNORMALSTYLE,k),jQuery(o).on(o.events.PLACEIMAGE,S),t.on(s.eventSizeChange,A),e.on("click",".ug-tile",P),e.on("click",".ug-tile .ug-button-play",R),e.on("click",".ug-tile .ug-icon-link",B)},this.destroy=function(){if(e.off("click",".ug-tile"),e.off("click",".ug-tile .ug-button-play"),e.off("click",".ug-tile .ug-icon-link"),jQuery(o).off(o.events.SETOVERSTYLE),jQuery(o).off(o.events.SETNORMALSTYLE),jQuery(o).off(o.events.PLACEIMAGE),t.off(s.eventSizeChange),1==r.tile_enable_textpanel){var i=o.getThumbs();jQuery.each(i,(function(e,t){var i=p(jQuery(t));i&&i.destroy()}))}o.destroy()},this.init=function(e,t,i){u(e,t)},this.setFixedMode=function(){r.tile_size_by=i.sizeby.GLOBAL_RATIO,r.tile_visible_before_image=!0},this.setApproveClickFunction=function(e){s.funcParentApproveClick=e},this.resizeTile=function(e,t,n,l){if(1==s.isTextpanelOutside&&x(e,"clone",t),t){if(!n)n=i.getTileHeightByWidth(t,e)}else{t=r.tile_width;var n=r.tile_height}switch(a.setElementSize(e,t,n),l){default:case i.resizemode.FULL:i.triggerSizeChangeEvent(e,!0);break;case i.resizemode.WRAPPER_ONLY:return!0;case i.resizemode.VISIBLE_ELEMENTS:if(s.funcCustomTileHtml)return i.triggerSizeChangeEvent(e,!0),!0;w(e,t,n,!0),1==r.tile_enable_textpanel&&1==r.tile_textpanel_always_on&&t&&x(e,"regular",t,n)}},this.resizeAllTiles=function(e,t,n){c();var l=null;if(r.tile_size_by==i.sizeby.GLOBAL_RATIO&&(l=i.getTileHeightByWidth(e)),!n)n=o.getThumbs();n.each((function(n,a){i.resizeTile(jQuery(a),e,l,t)}))},this.triggerSizeChangeEvent=function(e,i){if(!e)return!1;if(!i)i=!1;t.trigger(s.eventSizeChange,[e,i])},this.triggerSizeChangeEventAllTiles=function(e){o.getThumbs().each((function(){var t=jQuery(this);i.triggerSizeChangeEvent(t,e)}))},this.disableEvents=function(){o.getThumbs().css("pointer-events","none")},this.enableEvents=function(){o.getThumbs().css("pointer-events","auto")},this.setOptions=function(e){r=jQuery.extend(r,e),o.setOptions(e)},this.setTileSizeOptions=function(e){if(r.tile_size_by!==i.sizeby.GLOBAL_RATIO)throw new Error("setNewTileOptions works with global ration only");r.tile_width=e,r.tile_height=Math.floor(e*s.ratioByHeight)},this.setCustomFunctions=function(e,t){s.funcCustomTileHtml=e,s.funcCustomPositionElements=t},this.run=function(e){var t=o.type.GET_THUMBS_ALL;!0===e&&(t=o.type.GET_THUMBS_NEW);var n=o.getThumbs(t);r.tile_size_by==i.sizeby.GLOBAL_RATIO&&i.resizeAllTiles(r.tile_width,i.resizemode.WRAPPER_ONLY,n),1==r.tile_enable_image_effect&&0==r.tile_image_effect_reverse&&n.children(".ug-thumb-image").fadeTo(0,0),o.setHtmlProperties(n),1==r.tile_visible_before_image&&(n.children(".ug-thumb-image").fadeTo(0,0),o.loadThumbsImages())},this._____________EXTERNAL_GETTERS____________=function(){},this.getObjThumbs=function(){return o},this.getOptions=function(){return r},this.getTileImage=function(e){return e.find("img.ug-thumb-image")},this.getItemByTile=function(e){return o.getItemByThumb(e)},this.getTileHeightByWidth=function(e,t){var n=function(e){var t=s.ratioByHeight;switch(r.tile_size_by){default:t=s.ratioByHeight;break;case i.sizeby.IMAGE_RATIO:if(!e)throw new Error("tile should be given for tile ratio");var n=i.getItemByTile(e);if(void 0!==n.thumbRatioByHeight){if(0==n.thumbRatioByHeight)throw trace(n),new Error("the item ratio not inited yet");t=n.thumbRatioByHeight}break;case i.sizeby.CUSTOM:return null}return t}(t);if(null===n)return null;var l=Math.floor((e-s.tileInnerReduce)*n)+s.tileInnerReduce;return t&&1==s.isTextpanelOutside&&r.tile_size_by==i.sizeby.IMAGE_RATIO&&(l+=f(t)),l},this.getTileImageSize=function(e){var t=i.getItemByTile(e);if(!t.thumbWidth||!t.thumbHeight)throw new Error("Can't get image size - image not inited.");return{width:t.thumbWidth,height:t.thumbHeight}},this.getGlobalTileSize=function(){if(r.tile_size_by!=i.sizeby.GLOBAL_RATIO)throw new Error("The size has to be global ratio");return{width:r.tile_width,height:r.tile_height}}}